<!-- Created with Jaspersoft Studio version 7.0.3.final using JasperReports Library version 7.0.3-41034ca841d452f3305ba55b9042260aaa1ab5dd  -->
<jasperReport name="Factura" language="java" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="40c5054d-9133-4a11-8255-086389234856">
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="BDGestorFacturasEmpresa"/>
	<parameter name="P_FACTURA_ID" class="java.lang.Long"/>
	<parameter name="P_EMPRESA_ID" class="java.lang.Long"/>
	<parameter name="SUBREPORT_OBJECT" class="net.sf.jasperreports.engine.JasperReport"/>
	<query language="SQL"><![CDATA[SELECT
	f.id AS id,
	f.numero AS numero_factura,
	f.fecha_emision,
	f.concepto,
	f.base_imponible,
	f.iva_total,
	f.total_factura,
	f.estado,
	f.observaciones,
	-- Datos Cliente Generales
	e.nombre AS entidad_nombre,
	e.nif AS entidad_nif,
	e.email AS entidad_email,
	-- Dirección FISCAL
	d_fis.direccion AS dir_fiscal,
	d_fis.ciudad AS ciu_fiscal,
	d_fis.cp AS cp_fiscal,
	-- Dirección ENVIO
	d_env.direccion AS dir_envio,
	d_env.ciudad AS ciu_envio,
	d_env.cp AS cp_envio,
	-- Datos Empresa (Emisor)
	em.nombre AS emp_nombre,
	em.nif AS emp_nif,
	em.direccion AS emp_direccion,
	em.ciudad AS emp_ciudad,
	em.cp AS emp_cp,
	em.telefono AS emp_telefono,
	em.email AS emp_email
FROM
	factura f
JOIN
	entidad e ON f.entidad_id = e.id
-- JOIN para Dirección FISCAL
LEFT JOIN
	direccion d_fis ON f.entidad_id = d_fis.entidad_id AND d_fis.etiqueta = 'Fiscal'
-- JOIN para Dirección ENVIO
LEFT JOIN
	direccion d_env ON f.entidad_id = d_env.entidad_id AND d_env.etiqueta = 'Envio'
JOIN
	empresa em ON f.empresa_id = em.id
WHERE
	f.id = $P{P_FACTURA_ID}
AND f.empresa_id = $P{P_EMPRESA_ID}
LIMIT 1]]></query>
	<field name="id" class="java.lang.Long">
		<property name="com.jaspersoft.studio.field.name" value="id"/>
		<property name="com.jaspersoft.studio.field.label" value="id"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="factura"/>
	</field>
	<field name="numero_factura" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="numero"/>
		<property name="com.jaspersoft.studio.field.label" value="numero_factura"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="factura"/>
	</field>
	<field name="fecha_emision" class="java.sql.Date">
		<property name="com.jaspersoft.studio.field.name" value="fecha_emision"/>
		<property name="com.jaspersoft.studio.field.label" value="fecha_emision"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="factura"/>
	</field>
	<field name="concepto" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="concepto"/>
		<property name="com.jaspersoft.studio.field.label" value="concepto"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="factura"/>
	</field>
	<field name="base_imponible" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="base_imponible"/>
		<property name="com.jaspersoft.studio.field.label" value="base_imponible"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="factura"/>
	</field>
	<field name="iva_total" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="iva_total"/>
		<property name="com.jaspersoft.studio.field.label" value="iva_total"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="factura"/>
	</field>
	<field name="total_factura" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="total_factura"/>
		<property name="com.jaspersoft.studio.field.label" value="total_factura"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="factura"/>
	</field>
	<field name="estado" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="estado"/>
		<property name="com.jaspersoft.studio.field.label" value="estado"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="factura"/>
	</field>
	<field name="observaciones" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="observaciones"/>
		<property name="com.jaspersoft.studio.field.label" value="observaciones"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="factura"/>
	</field>
	<field name="entidad_nombre" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="nombre"/>
		<property name="com.jaspersoft.studio.field.label" value="entidad_nombre"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="entidad"/>
	</field>
	<field name="entidad_nif" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="nif"/>
		<property name="com.jaspersoft.studio.field.label" value="entidad_nif"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="entidad"/>
	</field>
	<field name="entidad_email" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="email"/>
		<property name="com.jaspersoft.studio.field.label" value="entidad_email"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="entidad"/>
	</field>
	<field name="dir_fiscal" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="direccion"/>
		<property name="com.jaspersoft.studio.field.label" value="dir_fiscal"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="direccion"/>
	</field>
	<field name="ciu_fiscal" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="ciudad"/>
		<property name="com.jaspersoft.studio.field.label" value="ciu_fiscal"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="direccion"/>
	</field>
	<field name="cp_fiscal" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="cp"/>
		<property name="com.jaspersoft.studio.field.label" value="cp_fiscal"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="direccion"/>
	</field>
	<field name="dir_envio" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="direccion"/>
		<property name="com.jaspersoft.studio.field.label" value="dir_envio"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="direccion"/>
	</field>
	<field name="ciu_envio" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="ciudad"/>
		<property name="com.jaspersoft.studio.field.label" value="ciu_envio"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="direccion"/>
	</field>
	<field name="cp_envio" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="cp"/>
		<property name="com.jaspersoft.studio.field.label" value="cp_envio"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="direccion"/>
	</field>
	<field name="emp_nombre" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="nombre"/>
		<property name="com.jaspersoft.studio.field.label" value="emp_nombre"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="empresa"/>
	</field>
	<field name="emp_nif" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="nif"/>
		<property name="com.jaspersoft.studio.field.label" value="emp_nif"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="empresa"/>
	</field>
	<field name="emp_direccion" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="direccion"/>
		<property name="com.jaspersoft.studio.field.label" value="emp_direccion"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="empresa"/>
	</field>
	<field name="emp_ciudad" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="ciudad"/>
		<property name="com.jaspersoft.studio.field.label" value="emp_ciudad"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="empresa"/>
	</field>
	<field name="emp_cp" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="cp"/>
		<property name="com.jaspersoft.studio.field.label" value="emp_cp"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="empresa"/>
	</field>
	<field name="emp_telefono" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="telefono"/>
		<property name="com.jaspersoft.studio.field.label" value="emp_telefono"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="empresa"/>
	</field>
	<field name="emp_email" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="email"/>
		<property name="com.jaspersoft.studio.field.label" value="emp_email"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="empresa"/>
	</field>
	<background splitType="Stretch"/>
	<title height="230" splitType="Stretch">
		<element kind="textField" uuid="a1234567-1234-1234-1234-123456789001" x="0" y="0" width="300" height="25" fontSize="18.0" bold="true">
			<expression><![CDATA[$F{emp_nombre}]]></expression>
		</element>
		<element kind="textField" uuid="a1234567-1234-1234-1234-123456789002" x="0" y="25" width="300" height="15" forecolor="#555555">
			<expression><![CDATA["NIF: " + $F{emp_nif}]]></expression>
		</element>
		<element kind="textField" uuid="a1234567-1234-1234-1234-123456789003" x="0" y="40" width="300" height="15" forecolor="#555555">
			<expression><![CDATA[$F{emp_direccion}]]></expression>
		</element>
		<element kind="textField" uuid="a1234567-1234-1234-1234-123456789004" x="0" y="55" width="300" height="15" forecolor="#555555">
			<expression><![CDATA[$F{emp_cp} + " " + $F{emp_ciudad}]]></expression>
		</element>
		<element kind="textField" uuid="a1234567-1234-1234-1234-123456789005" x="0" y="70" width="300" height="15" forecolor="#555555">
			<expression><![CDATA["Tlf: " + $F{emp_telefono} + " | " + $F{emp_email}]]></expression>
		</element>
		<element kind="staticText" uuid="b1234567-1234-1234-1234-123456789001" x="355" y="0" width="200" height="30" forecolor="#000000" fontSize="22.0" bold="true" hTextAlign="Right">
			<text><![CDATA[FACTURA]]></text>
		</element>
		<element kind="staticText" uuid="b1234567-1234-1234-1234-123456789002" x="355" y="35" width="80" height="20" forecolor="#666666" bold="true" hTextAlign="Right">
			<text><![CDATA[NÚMERO:]]></text>
		</element>
		<element kind="textField" uuid="b1234567-1234-1234-1234-123456789003" x="445" y="35" width="110" height="20" hTextAlign="Right">
			<expression><![CDATA[$F{numero_factura}]]></expression>
		</element>
		<element kind="staticText" uuid="b1234567-1234-1234-1234-123456789004" x="355" y="55" width="80" height="20" forecolor="#666666" bold="true" hTextAlign="Right">
			<text><![CDATA[FECHA:]]></text>
		</element>
		<element kind="textField" uuid="b1234567-1234-1234-1234-123456789005" x="445" y="55" width="110" height="20" pattern="dd/MM/yyyy" hTextAlign="Right">
			<expression><![CDATA[$F{fecha_emision}]]></expression>
		</element>
		<element kind="textField" uuid="b1234567-1234-1234-1234-123456789006" mode="Opaque" x="455" y="80" width="100" height="20" backcolor="#E0E0E0" bold="true" hTextAlign="Center" vTextAlign="Middle">
			<expression><![CDATA[$F{estado}]]></expression>
		</element>
		<element kind="line" uuid="c1234567-1234-1234-1234-123456789001" x="0" y="105" width="555" height="1" forecolor="#CCCCCC"/>
		<element kind="rectangle" uuid="d1234567-1234-1234-1234-123456789001" x="0" y="115" width="270" height="105" backcolor="#F9F9F9">
			<pen lineWidth="0.0"/>
		</element>
		<element kind="staticText" uuid="d1234567-1234-1234-1234-123456789002" x="10" y="120" width="200" height="15" forecolor="#999999" fontSize="8.0" bold="true">
			<text><![CDATA[FACTURAR A (Dirección Fiscal):]]></text>
		</element>
		<element kind="textField" uuid="d1234567-1234-1234-1234-123456789003" x="10" y="135" width="250" height="20" fontSize="11.0" bold="true">
			<expression><![CDATA[$F{entidad_nombre}]]></expression>
		</element>
		<element kind="textField" uuid="d1234567-1234-1234-1234-123456789004" x="10" y="155" width="250" height="15">
			<expression><![CDATA["NIF: " + $F{entidad_nif}]]></expression>
		</element>
		<element kind="textField" uuid="d1234567-1234-1234-1234-123456789005" x="10" y="170" width="250" height="15">
			<expression><![CDATA[$F{dir_fiscal} != null ? $F{dir_fiscal} : ""]]></expression>
		</element>
		<element kind="textField" uuid="d1234567-1234-1234-1234-123456789006" x="10" y="185" width="250" height="15">
			<expression><![CDATA[($F{cp_fiscal}!=null?$F{cp_fiscal}:"") + " " + ($F{ciu_fiscal}!=null?$F{ciu_fiscal}:"")]]></expression>
		</element>
		<element kind="rectangle" uuid="e1234567-1234-1234-1234-123456789001" x="285" y="115" width="270" height="105" backcolor="#F9F9F9">
			<pen lineWidth="0.0"/>
		</element>
		<element kind="staticText" uuid="e1234567-1234-1234-1234-123456789002" x="295" y="120" width="200" height="15" forecolor="#999999" fontSize="8.0" bold="true">
			<text><![CDATA[ENVIAR A (Dirección de Envío):]]></text>
		</element>
		<element kind="textField" uuid="e1234567-1234-1234-1234-123456789003" x="295" y="135" width="250" height="20" fontSize="11.0" bold="true">
			<expression><![CDATA[$F{entidad_nombre}]]></expression>
		</element>
		<element kind="textField" uuid="e1234567-1234-1234-1234-123456789004" x="295" y="170" width="250" height="15">
			<expression><![CDATA[$F{dir_envio} != null ? $F{dir_envio} : "Misma dirección fiscal"]]></expression>
		</element>
		<element kind="textField" uuid="e1234567-1234-1234-1234-123456789005" x="295" y="185" width="250" height="15">
			<expression><![CDATA[$F{dir_envio} != null ? (($F{cp_envio}!=null?$F{cp_envio}:"") + " " + ($F{ciu_envio}!=null?$F{ciu_envio}:"")) : ""]]></expression>
		</element>
		<element kind="textField" uuid="24e80ff1-44ca-461b-a34a-3f7b84f517e0" x="295" y="155" width="250" height="15">
			<expression><![CDATA["NIF: " + $F{entidad_nif}]]></expression>
		</element>
	</title>
	<columnHeader height="30" splitType="Stretch">
		<element kind="staticText" uuid="f1234567-1234-1234-1234-123456789001" x="0" y="0" width="100" height="15" forecolor="#666666" fontSize="8.0">
			<text><![CDATA[ASUNTO / PROYECTO]]></text>
		</element>
		<element kind="textField" uuid="f1234567-1234-1234-1234-123456789002" x="0" y="10" width="555" height="20" fontSize="10.0" bold="true">
			<expression><![CDATA[$F{concepto}]]></expression>
		</element>
	</columnHeader>
	<detail>
		<band height="60" splitType="Stretch">
			<element kind="subreport" uuid="a1b2c3d4-1234-1234-1234-123456789099" x="0" y="10" width="555" height="50">
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<expression><![CDATA[$P{SUBREPORT_OBJECT}]]></expression>
				<parameter name="P_FACTURA_ID_SUB">
					<expression><![CDATA[$F{id}]]></expression>
				</parameter>
			</element>
		</band>
	</detail>
	<columnFooter height="150" splitType="Stretch">
		<element kind="line" uuid="01234567-1234-1234-1234-123456789001" x="0" y="5" width="555" height="1" forecolor="#DDDDDD"/>
		<element kind="staticText" uuid="01234567-1234-1234-1234-123456789002" x="0" y="15" width="200" height="15" bold="true">
			<text><![CDATA[Notas / Observaciones:]]></text>
		</element>
		<element kind="textField" uuid="01234567-1234-1234-1234-123456789003" x="0" y="30" width="280" height="60" forecolor="#555555" fontSize="9.0">
			<expression><![CDATA[$F{observaciones}]]></expression>
		</element>
		<element kind="staticText" uuid="01234567-1234-1234-1234-123456789004" x="330" y="15" width="100" height="20" hTextAlign="Right">
			<text><![CDATA[Base Imponible:]]></text>
		</element>
		<element kind="textField" uuid="01234567-1234-1234-1234-123456789005" x="440" y="15" width="115" height="20" pattern="#,##0.00 ¤" hTextAlign="Right">
			<expression><![CDATA[$F{base_imponible}]]></expression>
		</element>
		<element kind="staticText" uuid="01234567-1234-1234-1234-123456789006" x="330" y="35" width="100" height="20" hTextAlign="Right">
			<text><![CDATA[IVA (21%):]]></text>
		</element>
		<element kind="textField" uuid="01234567-1234-1234-1234-123456789007" x="440" y="35" width="115" height="20" pattern="#,##0.00 ¤" hTextAlign="Right">
			<expression><![CDATA[$F{iva_total}]]></expression>
		</element>
		<element kind="rectangle" uuid="01234567-1234-1234-1234-123456789008" x="330" y="65" width="225" height="30" backcolor="#F0F0F0">
			<pen lineWidth="0.0"/>
		</element>
		<element kind="staticText" uuid="01234567-1234-1234-1234-123456789009" x="340" y="65" width="100" height="30" fontSize="14.0" bold="true" vTextAlign="Middle">
			<text><![CDATA[TOTAL:]]></text>
		</element>
		<element kind="textField" uuid="01234567-1234-1234-1234-123456789010" x="440" y="65" width="110" height="30" fontSize="16.0" pattern="#,##0.00 ¤" bold="true" hTextAlign="Right" vTextAlign="Middle">
			<expression><![CDATA[$F{total_factura}]]></expression>
		</element>
	</columnFooter>
</jasperReport>
